{% extends 'admin/layout.html' %}
{% block content %}
<div class="container-fluid mt-4">
  <div class="row">
    <div class="col-12">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h3 class="mb-0">
          <i class="bi bi-graph-up me-2 text-primary"></i>
          Laporan Penjualan
        </h3>
        <a href="{{ url_for('export_laporan_excel') }}?start_date={{ request.args.get('start_date', '') }}&end_date={{ request.args.get('end_date', '') }}" 
           class="btn btn-success">
          <i class="bi bi-file-earmark-excel me-1"></i> Export Excel
        </a>
      </div>

      <!-- Filter Section (optional) -->
      <div class="card mb-4 border-0 shadow-sm">
        <div class="card-body py-3">
          <div class="row align-items-center">
            <div class="col-auto">
              <small class="text-muted fw-medium">Filter Periode:</small>
            </div>
            <div class="col-auto">
              <span class="badge bg-light text-dark px-3 py-2">
                {{ request.args.get('start_date', 'Semua') }} - {{ request.args.get('end_date', 'Data') }}
              </span>
            </div>
          </div>
        </div>
      </div>

      <!-- Main Table -->
      <div class="card border-0 shadow-sm">
        <div class="card-header bg-white border-bottom-0 py-3">
          <h6 class="mb-0 text-muted fw-medium">
            <i class="bi bi-table me-2"></i>Detail Transaksi Penjualan
          </h6>
        </div>
        <div class="card-body p-0">
          <div class="table-responsive">
            <table class="table table-modern mb-0 align-middle">
              <thead class="table-header-custom">
                <tr>
                  <th scope="col" class="text-center fw-bold text-white" style="width: 60px;">
                    <i class="bi bi-hash me-1"></i>No
                  </th>
                  <th scope="col" class="fw-bold text-white" style="width: 180px;">
                    <i class="bi bi-person me-1"></i>Pelanggan
                  </th>
                  <th scope="col" class="fw-bold text-white" style="width: 200px;">
                    <i class="bi bi-card-checklist me-1"></i>Menu
                  </th>
                  <th scope="col" class="text-center fw-bold text-white" style="width: 100px;">
                    <i class="bi bi-box me-1"></i>Qty
                  </th>
                  <th scope="col" class="text-end fw-bold text-white" style="width: 130px;">
                    <i class="bi bi-tag me-1"></i>Harga Satuan
                  </th>
                  <th scope="col" class="text-end fw-bold text-white" style="width: 140px;">
                    <i class="bi bi-currency-dollar me-1"></i>Total Harga
                  </th>
                  <th scope="col" class="text-center fw-bold text-white" style="width: 120px;">
                    <i class="bi bi-calendar me-1"></i>Tanggal
                  </th>
                </tr>
              </thead>
              <tbody class="table-body-modern">
                {% set grand_total = namespace(value=0) %}
                {% set total_items = namespace(value=0) %}
                {% for row in laporan %}
                  {% set jumlah = row[3]|int %}
                  {% set harga = row[4]|int %}
                  {% set total = row[5]|int %}
                  {% set grand_total.value = grand_total.value + total %}
                  {% set total_items.value = total_items.value + jumlah %}
                  <tr class="table-row-modern">
                    <td class="text-center">
                      <div class="row-number">
                        {{ loop.index }}
                      </div>
                    </td>
                    <td>
                      <div class="customer-info">
                        <div class="customer-avatar">
                          <i class="bi bi-person-circle"></i>
                        </div>
                        <div class="customer-details">
                          <div class="customer-name">{{ row[1] }}</div>
                          <div class="customer-label">Pelanggan</div>
                        </div>
                      </div>
                    </td>
                    <td>
                      <div class="menu-info">
                        <div class="menu-icon">
                          {% if 'minum' in row[2]|lower or 'drink' in row[2]|lower or 'jus' in row[2]|lower or 'kopi' in row[2]|lower or 'teh' in row[2]|lower or 'soda' in row[2]|lower or 'air' in row[2]|lower %}
                          <i class="bi bi-cup-hot drink-icon"></i>
                          {% else %}
                          <i class="bi bi-basket food-icon"></i>
                          {% endif %}
                        </div>
                        <div class="menu-details">
                          <div class="menu-name">{{ row[2] }}</div>
                          <div class="menu-category">
                            {% if 'minum' in row[2]|lower or 'drink' in row[2]|lower or 'jus' in row[2]|lower or 'kopi' in row[2]|lower or 'teh' in row[2]|lower or 'soda' in row[2]|lower or 'air' in row[2]|lower %}
                            Minuman
                            {% else %}
                            Makanan
                            {% endif %}
                          </div>
                        </div>
                      </div>
                    </td>
                    <td class="text-center">
                      <div class="quantity-badge">
                        <span class="qty-number">{{ jumlah }}</span>
                        <span class="qty-label">pcs</span>
                      </div>
                    </td>
                    <td class="text-end">
                      <div class="price-info">
                        <div class="price-amount">Rp {{ "{:,}".format(harga) }}</div>
                        <div class="price-label">per item</div>
                      </div>
                    </td>
                    <td class="text-end">
                      <div class="total-price">
                        <div class="total-amount">Rp {{ "{:,}".format(total) }}</div>
                        <div class="total-label">total</div>
                      </div>
                    </td>
                    <td class="text-center">
                      <div class="date-info">
                        <div class="date-value">{{ row[6].strftime('%d/%m') if row[6] else '-' }}</div>
                        <div class="date-year">{{ row[6].strftime('%Y') if row[6] else '-' }}</div>
                      </div>
                    </td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
        
        <!-- Table Footer with Summary -->
        <div class="card-footer bg-light border-top">
          <div class="row align-items-center">
            <div class="col-md-8">
              <div class="d-flex align-items-center">
                <i class="bi bi-calculator text-primary me-2"></i>
                <span class="fw-bold text-dark fs-5">RINGKASAN TOTAL</span>
              </div>
            </div>
            <div class="col-md-4">
              <div class="text-end">
                <div class="mb-1">
                  <small class="text-muted">Total Item:</small>
                  <span class="fw-bold text-info ms-2">{{ total_items.value }}</span>
                </div>
                <div>
                  <small class="text-muted">Grand Total:</small>
                  <span class="fw-bold text-success fs-5 ms-2">
                    Rp{{ "{:,}".format(grand_total.value) }}
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Summary Cards -->
      <div class="row mt-4">
        <div class="col-lg-4 col-md-6 mb-3">
          <div class="card border-0 shadow-sm h-100">
            <div class="card-body text-center">
              <div class="avatar-lg bg-primary rounded-circle mx-auto mb-3 d-flex align-items-center justify-content-center">
                <i class="bi bi-cart3 text-white fs-4"></i>
              </div>
              <h6 class="text-muted mb-2">Total Transaksi</h6>
              <h3 class="text-primary mb-0 fw-bold">{{ laporan|length }}</h3>
              <small class="text-muted">transaksi</small>
            </div>
          </div>
        </div>
        
        <div class="col-lg-4 col-md-6 mb-3">
          <div class="card border-0 shadow-sm h-100">
            <div class="card-body text-center">
              <div class="avatar-lg bg-success rounded-circle mx-auto mb-3 d-flex align-items-center justify-content-center">
                <i class="bi bi-currency-exchange text-white fs-4"></i>
              </div>
              <h6 class="text-muted mb-2">Total Penjualan</h6>
              <h3 class="text-success mb-0 fw-bold">Rp{{ "{:,}".format(grand_total.value) }}</h3>
              <small class="text-muted">rupiah</small>
            </div>
          </div>
        </div>
        
        <div class="col-lg-4 col-md-12 mb-3">
          <div class="card border-0 shadow-sm h-100">
            <div class="card-body text-center">
              <div class="avatar-lg bg-info rounded-circle mx-auto mb-3 d-flex align-items-center justify-content-center">
                <i class="bi bi-box-seam text-white fs-4"></i>
              </div>
              <h6 class="text-muted mb-2">Total Item Terjual</h6>
              <h3 class="text-info mb-0 fw-bold">{{ total_items.value }}</h3>
              <small class="text-muted">item</small>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
.avatar-sm {
  width: 32px;
  height: 32px;
  font-size: 12px;
}

.avatar-lg {
  width: 60px;
  height: 60px;
}

/* CUSTOM HEADER TABLE STYLING - PERBAIKAN UTAMA */
.table-header-custom {
  background: linear-gradient(135deg, #2c3e50, #34495e) !important;
  border-bottom: 3px solid #1a252f;
}

.table-header-custom th {
  background: transparent !important;
  color: #ffffff !important;
  font-weight: 700 !important;
  font-size: 0.9rem !important;
  letter-spacing: 0.5px !important;
  text-transform: uppercase !important;
  padding: 1rem 0.75rem !important;
  border-bottom: 2px solid #1a252f !important;
  position: relative;
}

.table-header-custom th::after {
  content: '';
  position: absolute;
  bottom: -2px;
  left: 0;
  right: 0;
  height: 2px;
  background: linear-gradient(90deg, #3498db, #2980b9);
}

.table-header-custom th i {
  color: #3498db !important;
  font-size: 1rem !important;
}

/* HOVER EFFECT UNTUK HEADER */
.table-header-custom th:hover {
  background: rgba(52, 152, 219, 0.1) !important;
  transform: translateY(-1px);
  transition: all 0.2s ease;
}

/* MODERN TABLE STYLING */
.table-modern {
  border-collapse: separate;
  border-spacing: 0;
  background: #ffffff;
  border-radius: 12px;
  overflow: hidden;
  box-shadow: 0 10px 30px rgba(0,0,0,0.1);
}

.table-body-modern {
  background: linear-gradient(145deg, #f8f9fa, #ffffff);
}

.table-row-modern {
  border: none;
  border-bottom: 1px solid rgba(0,0,0,0.05);
  transition: all 0.3s ease;
  position: relative;
}

.table-row-modern:hover {
  background: linear-gradient(135deg, rgba(52, 152, 219, 0.08), rgba(155, 89, 182, 0.05));
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(52, 152, 219, 0.15);
}

.table-row-modern td {
  padding: 1.2rem 1rem;
  vertical-align: middle;
  border: none;
}

/* ROW NUMBER STYLING */
.row-number {
  width: 35px;
  height: 35px;
  background: linear-gradient(135deg, #667eea, #764ba2);
  color: white;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 700;
  font-size: 0.85rem;
  margin: 0 auto;
  box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
}

/* CUSTOMER INFO STYLING */
.customer-info {
  display: flex;
  align-items: center;
  gap: 12px;
}

.customer-avatar {
  font-size: 2rem;
  color: #667eea;
  filter: drop-shadow(0 2px 4px rgba(102, 126, 234, 0.3));
}

.customer-name {
  font-weight: 600;
  color: #2c3e50;
  font-size: 0.95rem;
  margin-bottom: 2px;
}

.customer-label {
  font-size: 0.75rem;
  color: #7f8c8d;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

/* MENU INFO STYLING */
.menu-info {
  display: flex;
  align-items: center;
  gap: 12px;
}

.menu-icon {
  font-size: 1.5rem;
  width: 40px;
  height: 40px;
  border-radius: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.drink-icon {
  color: #3498db;
  background: rgba(52, 152, 219, 0.1);
}

.food-icon {
  color: #e67e22;
  background: rgba(230, 126, 34, 0.1);
}

.menu-name {
  font-weight: 600;
  color: #2c3e50;
  font-size: 0.95rem;
  margin-bottom: 2px;
}

.menu-category {
  font-size: 0.75rem;
  color: #7f8c8d;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

/* QUANTITY BADGE STYLING */
.quantity-badge {
  background: linear-gradient(135deg, #00b894, #00a085);
  color: white;
  padding: 8px 16px;
  border-radius: 20px;
  display: inline-flex;
  flex-direction: column;
  align-items: center;
  box-shadow: 0 4px 12px rgba(0, 184, 148, 0.3);
  min-width: 60px;
}

.qty-number {
  font-weight: 700;
  font-size: 1.1rem;
  line-height: 1;
}

.qty-label {
  font-size: 0.7rem;
  opacity: 0.8;
  margin-top: 2px;
}

/* PRICE INFO STYLING */
.price-info {
  text-align: right;
}

.price-amount {
  font-weight: 600;
  color: #2c3e50;
  font-size: 0.95rem;
  margin-bottom: 2px;
}

.price-label {
  font-size: 0.75rem;
  color: #7f8c8d;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

/* TOTAL PRICE STYLING */
.total-price {
  text-align: right;
  background: linear-gradient(135deg, #00b894, #00a085);
  color: white;
  padding: 8px 12px;
  border-radius: 8px;
  box-shadow: 0 4px 12px rgba(0, 184, 148, 0.2);
}

.total-amount {
  font-weight: 700;
  font-size: 1rem;
  margin-bottom: 2px;
}

.total-label {
  font-size: 0.7rem;
  opacity: 0.8;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

/* DATE INFO STYLING */
.date-info {
  background: linear-gradient(135deg, #6c5ce7, #a29bfe);
  color: white;
  padding: 8px 12px;
  border-radius: 8px;
  text-align: center;
  box-shadow: 0 4px 12px rgba(108, 92, 231, 0.3);
}

.date-value {
  font-weight: 700;
  font-size: 0.95rem;
  margin-bottom: 2px;
}

.date-year {
  font-size: 0.75rem;
  opacity: 0.8;
}

.card {
  transition: all 0.3s ease;
}

.card:hover {
  transform: translateY(-2px);
}

.summary-card:hover {
  transform: scale(1.02);
}

.table td {
  vertical-align: middle;
  padding: 1rem 0.75rem;
}

.border-bottom {
  border-bottom: 1px solid #f1f3f4 !important;
}

/* RESPONSIVE DESIGN */
@media (max-width: 768px) {
  .table-responsive {
    font-size: 0.875rem;
  }
  
  .table-header-custom th {
    font-size: 0.8rem !important;
    padding: 0.75rem 0.5rem !important;
  }
  
  .avatar-sm {
    width: 24px;
    height: 24px;
    font-size: 10px;
  }
  
  .avatar-lg {
    width: 48px;
    height: 48px;
  }
}

/* ADDITIONAL CONTRAST IMPROVEMENTS */
.table-header-custom th .bi {
  text-shadow: 0 1px 2px rgba(0,0,0,0.3);
}

.table-header-custom th {
  text-shadow: 0 1px 2px rgba(0,0,0,0.5);
  box-shadow: inset 0 1px 0 rgba(255,255,255,0.1);
}
</style>
{% endblock %}